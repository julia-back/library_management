# Менеджер библиотеки

REST API для управления библиотекой: книгами, авторами, пользователями, выдачей книг.
Реализован функционал напоминаний по электронной почте о необходимости сдачи книги 
(за два дня до окончания срока выдачи книги и при просрочке).

## Содержание
- Установка
- Запуск
- Использование
- Тестирование
- Документация

## Установка
**Клонирование репозитория на локальный репозиторий:**
1. Чтобы клонировать репозиторий с GitHub себе на компьютер, необходимо
получить ссылку на доступ к репозиторию в разделе **Code** на странице
репозитория, выбрать способ взаимодействия с GitHub (**HTTPS**) и **скопировать**
ссылку на репозиторий для клонирования.
2. В главном меню **PyCharm** перейдите в меню **Get from VCS**. 
3. Вставьте ссылку на репозиторий и нажмите на кнопку **Clone**.
4. По окончании клонирования будет открыт проект, вы можете работать с этим проектом.

Или выполните команду ```git clone <ссылка_на_репозиторий>``` 

**Заполните переменные окружения** по образцу в `.env.simple`.

**Установка зависимостей:** ```poetry install```

**Создайте базу данных и выполните миграции:** ```python manage.py migrate```

**Выполните команду** для создания группы администраторов и пользователя-администратора:
```python manage.py create_admin_group_and_user```

## Запуск

**Ручной запуск.**
1. Запустите сервер: ```python manage.py runserver``` или ```gunicorn config.wsgi:application --bind 0.0.0.0:8000```
2. Запустите celery: ```celery -A config worker -l INFO -P gevent```
3. Запустите celery-beat: ```celery -A config beat -l INFO```
4. Запустите сервер redis удобным способом.

**Запуск с помощью Docker**
1. Выполните команду: ```docker-compose up -d --build```

## Использование
**После установки и запуска приложения**, вы можете делать запросы по доступным эндпоинтам:
- при ручном запуске по адресу ```http://localhost:8000```
- при запуске в контейнере по адресу ```http://localhost```

**Уровни доступа к эндпоинтам:**
- доступ всем неавторизованным пользователям
- доступ всем авторизованным пользователям
- доступ владельцам объекта
- доступ только пользователям, состоящим в группе администраторов

**Доступные эндпоинты:**

```books/```
- **book_create/** - создание книги, доступно только администраторам
- **book_list/** - список книг
- **book_retrieve/pk/** - детали книги
- **book_update/pk/** - обновление книги, доступно только администраторам
- **book_destroy/pk/** - удаление книги, доступно только администраторам

- **author_create/** - создание автора, доступно только администраторам
- **author_list/** - список авторов
- **author_retrieve/pk/** - детали автора
- **author_update/pk/**- обновление автора, доступно только администраторам
- **author_destroy/pk/** - удаление автора, доступно только администраторам

```users/```
- **token/** - получение токенов доступа
- **token_refresh/** - обновление токена
- **user/new/** - создание / регистрация пользователя
- **user_list/** - список пользователей, доступно только администраторам
- **user_retrieve/pk/** - детали пользователя
- **user_update/pk/** - обновление пользователя
- **user_destroy/pk/** - удаление пользователя
- **add_in_admin_group/pk/** - добавление пользователя в группу администраторов,
доступно только администраторам, первый администратор создается с помощью кастомной
команды (в разделе Установка).

```receipt/```
- **receipt/new/** - создание выдачи книги, доступно только администраторам
- **receipt_destroy/pk/** - удаление выдачи книги, доступно только администраторам
- **receipt_list/** - список выдачи книг, администраторы видят все выдачи книг,
авторизованные пользователи видят только свои выдачи книг
- **receipt_retrieve/pk/** - детали выдачи книги
- **return_book/pk/** - возврат книги, доступно только администраторам

Более подробно можно ознакомиться в документации.

## Тестирование

Для запуска тестов в проекте выполните команду ```python manage.py test```.
Для проверки покрытия кода тестами выполните команды 
```coverage run --source="." manage.py test``` и ```coverage report```.
  
Для запуска тестов в контейнере выполните команду: 
```docker-compose exec web poetry run python manage.py test```.

## Документация
После установки и запуска приложения документация будет доступна по следующим адресам:

1. **При ручном запуске приложения:**
- http://localhost:8000/docs/swagger-ui/
- http://localhost:8000/docs/redoc/

2. **При запуске в контейнере:**
- http://localhost/docs/swagger-ui/
- http://localhost/docs/redoc/

Эндпоинты с документацией доступны всем неавторизованным пользователям.
